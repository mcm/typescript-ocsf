import { z } from 'zod';

import { Advisory } from './advisory.js';
import { AffectedCode } from './affected_code.js';
import { AffectedPackage } from './affected_package.js';
import { Cve } from './cve.js';
import { Cwe } from './cwe.js';
import { KbArticle } from './kb_article.js';
import { Package } from './package.js';
import { Remediation } from './remediation.js';

/**
 * The vulnerability is an unintended characteristic of a computing component or system configuration that multiplies the risk of an adverse event or a loss occurring either due to accidental exposure, deliberate attack, or conflict with new system components.
 *
 * OCSF Object: Vulnerability Details
 */
export const Vulnerability: any = z.object({
  /** Detail about the security advisory, that is used to publicly disclose cybersecurity vulnerabilities by a vendor. */
  advisory: Advisory.optional(),
  /** List of Affected Code objects that describe details about code blocks identified as vulnerable. */
  affected_code: z.array(AffectedCode).optional(),
  /** List of software packages identified as affected by a vulnerability/vulnerabilities. */
  affected_packages: z.array(AffectedPackage).optional(),
  /** The category of a vulnerability or weakness, as reported by the source tool, such as Container Security or Open Source Security. */
  category: z.string().optional(),
  /** Describes the Common Vulnerabilities and Exposures (CVE) details related to the vulnerability. */
  cve: Cve.optional(),
  /** Describes the Common Weakness Enumeration (CWE) details related to the vulnerability. */
  cwe: Cwe.optional(),
  /** The description of the vulnerability. */
  desc: z.string().optional(),
  /** Information about the chain of dependencies related to the issue as reported by an Application Security or Vulnerability Management tool. E.g., serverless-offline -> @serverless/utils -> memoizee -> es5-ext. */
  dependency_chain: z.string().optional(),
  /** The time when the exploit was most recently observed. */
  exploit_last_seen_time: z.number().int().optional(),
  /** The URL of the exploit code or Proof-of-Concept (PoC). */
  exploit_ref_url: z.string().optional(),
  /** The requirement description related to any constraints around exploit execution. */
  exploit_requirement: z.string().optional(),
  /** The categorization or type of Exploit. E.g., Network or Physical. */
  exploit_type: z.string().optional(),
  /** The time when the vulnerability was first observed. */
  first_seen_time: z.number().int().optional(),
  /** Indicates if a fix is available for the reported vulnerability. */
  fix_available: z.boolean().optional(),
  /** The fix coverage, normalized to the caption of the fix_coverage_id value. */
  fix_coverage: z.string().optional(),
  /** The normalized identifier for fix coverage, applicable to this vulnerability. Typically useful, when there are multiple affected packages but only a subset have available fixes. */
  fix_coverage_id: z.number().int().optional(),
  /** Indicates if an exploit or a PoC (proof-of-concept) is available for the reported vulnerability. */
  is_exploit_available: z.boolean().optional(),
  /** Indicates if a fix is available for the reported vulnerability. */
  is_fix_available: z.boolean().optional(),
  /** A list of KB articles or patches related to an endpoint. A KB Article contains metadata that describes the patch or an update. */
  kb_article_list: z.array(KbArticle).optional(),
  /** The KB article/s related to the entity. A KB Article contains metadata that describes the patch or an update. */
  kb_articles: z.array(z.string()).optional(),
  /** The time when the vulnerability was most recently observed. */
  last_seen_time: z.number().int().optional(),
  /** List of vulnerable packages as identified by the security product */
  packages: z.array(Package).optional(),
  /** A list of reference URLs with additional information about the vulnerability. */
  references: z.array(z.string()).optional(),
  /** List of vulnerability IDs (e.g. CVE ID) that are related to this vulnerability. */
  related_vulnerabilities: z.array(z.string()).optional(),
  /** The remediation recommendations on how to mitigate the identified vulnerability. */
  remediation: Remediation.optional(),
  /** The vendor assigned severity of the vulnerability. */
  severity: z.string().optional(),
  /** A title or a brief phrase summarizing the discovered vulnerability. */
  title: z.string().optional(),
  /** The name of the vendor that identified the vulnerability. */
  vendor_name: z.string().optional(),
}).passthrough();

export type VulnerabilityType = z.infer<typeof Vulnerability>;
